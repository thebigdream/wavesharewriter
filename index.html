<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Waveshare 7.5-inch NFC E-Paper Checkerboard</title>
</head>
<body>
  <h1>Send Checkerboard to E-Paper Display</h1>
  <button id="updateButton">Send Checkerboard</button>

  <script>
    const WIDTH = 640;
    const HEIGHT = 384;

    // Generate a full-screen checkerboard pattern
    function generateCheckerboard() {
      const bytesPerRow = WIDTH / 8;
      const buffer = new Uint8Array(bytesPerRow * HEIGHT);

      for (let y = 0; y < HEIGHT; y++) {
        for (let xByte = 0; xByte < bytesPerRow; xByte++) {
          let byte = 0;
          for (let bit = 0; bit < 8; bit++) {
            const x = xByte * 8 + bit;
            // Checkerboard: black if (x/8 + y/8) is even
            const isBlack = ((Math.floor(x / 8) + Math.floor(y / 8)) % 2) === 0;
            if (isBlack) byte |= (1 << (7 - bit)); // MSB first
          }
          buffer[y * bytesPerRow + xByte] = byte;
        }
      }
      return buffer;
    }

    async function sendCheckerboard() {
      if ('NDEFWriter' in window) {
        const checkerboard = generateCheckerboard();

        try {
          const writer = new NDEFWriter();
          await writer.write({
            records: [{
              recordType: "mime",
              mediaType: "application/octet-stream",
              data: checkerboard.buffer
            }]
          });
          alert("Checkerboard sent! Tap your e-paper display.");
        } catch (error) {
          console.error("Error writing to NFC:", error);
          alert("Failed to write to NFC: " + error);
        }
      } else {
        alert("WebNFC is not supported in this browser.");
      }
    }

    document.getElementById('updateButton').addEventListener('click', sendCheckerboard);
  </script>
</body>
</html>
